<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Test</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
        }
        .test-container {
            text-align: center;
            margin-top: 50px;
        }
        .audio-button {
            margin: 10px;
            padding: 15px 30px;
            background: #333;
            color: #fff;
            border: 2px solid #fff;
            cursor: pointer;
            font-size: 16px;
            font-family: 'Courier New', monospace;
        }
        .audio-button:hover {
            background: #555;
        }
        .status {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #666;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Audio Test Page</h1>
        <p>Test if the converted MP3 files work correctly with Phaser</p>
        
        <button class="audio-button" onclick="testAudio('stage1')">Test Stage 1 BGM</button>
        <button class="audio-button" onclick="testAudio('stage2')">Test Stage 2 BGM</button>
        <button class="audio-button" onclick="testAudio('credits')">Test Credits BGM</button>
        <button class="audio-button" onclick="stopAll()">Stop All Audio</button>
        
        <div id="status" class="status">Ready to test audio...</div>
    </div>

    <script>
        let currentAudio = null;
        
        function updateStatus(message) {
            document.getElementById('status').innerText = message;
        }
        
        function testAudio(key) {
            // Stop any currently playing audio
            if (currentAudio) {
                currentAudio.stop();
            }
            
            updateStatus(`Testing ${key}...`);
            
            // Try to load and play the audio
            try {
                const audioConfig = {
                    loop: key !== 'credits', // Don't loop credits
                    volume: 0.5
                };
                
                currentAudio = game.sound.add(key, audioConfig);
                
                // Check if audio was actually loaded
                if (currentAudio && currentAudio.totalDuration > 0) {
                    currentAudio.play();
                    updateStatus(`✓ Successfully loaded and playing ${key}`);
                } else {
                    updateStatus(`✗ ${key} file not found. Please run convert_audio.bat first.`);
                }
            } catch (error) {
                updateStatus(`✗ Error loading ${key}: ${error.message}`);
                console.error(`Audio error for ${key}:`, error);
            }
        }
        
        function stopAll() {
            if (currentAudio) {
                currentAudio.stop();
                currentAudio = null;
                updateStatus('Audio stopped');
            }
            // Stop all sounds
            game.sound.stopAll();
        }
        
        // Phaser game configuration
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            backgroundColor: '#000000',
            audio: {
                disableWebAudio: false
            },
            preload: function() {
                // Load audio files with error handling
                this.load.audio('stage1', 'converted_audio/tm1_1.mp3');
                this.load.audio('stage2', 'converted_audio/tm1_2.mp3');
                this.load.audio('credits', 'converted_audio/tm1_endroll.mp3');
                
                // Add loading completion handler
                this.load.on('complete', function() {
                    updateStatus('Audio files loaded. Click buttons to test!');
                });
                
                // Add loading error handler
                this.load.on('loaderror', function(file) {
                    updateStatus(`Failed to load: ${file.key}`);
                });
            },
            create: function() {
                updateStatus('Game initialized. Run convert_audio.bat first, then refresh this page.');
            }
        };
        
        const game = new Phaser.Game(config);
    </script>
</body>
</html>